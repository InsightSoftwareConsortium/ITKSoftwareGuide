
\chapter{Spatial Objects}
\label{sec:SpatialObjects}

This chapter introduces the basic classes that describe
\doxygen{SpatialObject}s.

\section{Introduction}
\label{Introduction}

We promote the philosophy that many of the goals of medical image processing
are more effectively addressed if we consider them in the broader context
of object processing. ITK's Spatial Object class hierarchy provides a
consistent API for querying, manipulating, and interconnecting objects in
physical space.   Via this API, methods can be coded to be invariant to
the data structure used to store the objects being processed.   By
abstracting the representations of objects to support their representation
by data structures other than images, a broad range of medical image
analysis research is supported; key examples are described in the following.

\begin{description}
  \item[Model-to-image registration.] A mathematical instance of an object
  can be registered with an image to localize the instance of that object in
  the image.  Using SpatialObjects, mutual information, cross-correlation, and
  boundary-to-image metrics can be applied without modification to
  perform spatial object-to-image registration.

  \item[Model-to-model registration.] Iterative closest point, landmark, and
  surface distance minimization methods can be used with any ITK transform,
  to rigidly and non-rigidly register image, FEM, and Fourier
  descriptor-based representations of objects as SpatialObjects.

  \item[Atlas formation.] Collections of images or SpatialObjects can be
  integrated to represent expected object characteristics and their common
  modes of variation.  Labels can be associated with the objects of an atlas.

  \item[Storing segmentation results from one or multiple scans.] Results of
  segmentations are best stored in physical/world coordinates so that they
  can be combined and compared with other segmentations from other images
  taken at other resolutions.  Segmentation results from hand drawn contours,
  pixel labelings, or model-to-image registrations are treated consistently.

  \item[Capturing functional and logical relationships between objects.]
  SpatialObjects can have parent and children objects.  Queries made of an
  object (such as to determine if a point is inside of the object) can be
  made to integrate the responses from the children object.  Transformations
  applied to a parent can also be propagated to the children.  Thus, for
  example, when a liver model is moved, its vessels move with it.

  \item[Conversion to and from images.] Basic functions are provided to
  render any SpatialObject (or collection of SpatialObjects) into an image.

  \item[IO.] SpatialObject reading and writing to disk is independent of the
  SpatialObject class hierarchy.  Meta object IO (through
  \doxygen{MetaImageIO}) methods are provided, and others are easily defined.

  \item[Tubes, blobs, images, surfaces.] Are a few of the many SpatialObject
  data containers and types provided.  New types can be added, generally by
  only defining one or two member functions in a derived class.
\end{description}

In the remainder of this chapter several examples are used to demonstrate
the many spatial objects found in ITK and how they can be organized into
hierarchies using \doxygen{SceneSpatialObject}. Further the examples
illustrate how to use SpatialObject transformations to control and
calculate the position of objects in space.

\section{Hierarchy}

Spatial objects can be combined to form a hierarchy as a tree. By design, a SpatialObject can
have one parent and only one. Moreover, each transform is stored within each object,
therefore the hierarchy cannot
be described as a Directed Acyclic Graph (DAG) but effectively as a tree.
The user is responsible for maintaining the tree structure, no checking is done
to ensure a cycle-free tree.

\label{sec:SpatialObjectHierarchy}
\ifitkFullVersion
\input{SpatialObjectHierarchy.tex}
\fi

\section{SpatialObject Tree Container}
\label{sec:SpatialObjectTreeContainer}
\ifitkFullVersion
\input{SpatialObjectTreeContainer.tex}
\fi

\section{Transformations}
\label{sec:SpatialObjectTransforms}
\ifitkFullVersion
\input{SpatialObjectTransforms.tex}
\fi

\section{Types of Spatial Objects}
\label{sec:Principal Objects}

This section describes in detail the variety of spatial objects
implemented in ITK.

\subsection{ArrowSpatialObject}
\label{sec:ArrowSpatialObject}
\ifitkFullVersion
\input{ArrowSpatialObject.tex}
\fi

\subsection{BlobSpatialObject}
\label{sec:BlobSpatialObject}
\ifitkFullVersion
\input{BlobSpatialObject.tex}
\fi

\subsection{CylinderSpatialObject}
\label{sec:CylinderSpatialObject}
\ifitkFullVersion
\input{CylinderSpatialObject.tex}
\fi

\subsection{EllipseSpatialObject}
\label{sec:EllipseSpatialObject}
\ifitkFullVersion
\input{EllipseSpatialObject.tex}
\fi

\subsection{GaussianSpatialObject}
\label{sec:GaussianSpatialObject}
\ifitkFullVersion
\input{GaussianSpatialObject.tex}
\fi

\subsection{GroupSpatialObject}
\label{sec:GroupSpatialObject}
\ifitkFullVersion
\input{GroupSpatialObject.tex}
\fi

\subsection{ImageSpatialObject}
\label{sec:ImageSpatialObject}
\ifitkFullVersion
\input{ImageSpatialObject.tex}
\fi

\subsection{ImageMaskSpatialObject}
\label{sec:ImageMaskSpatialObject}
\ifitkFullVersion
\input{ImageMaskSpatialObject.tex}
\fi

\subsection{LandmarkSpatialObject}
\label{sec:LandmarkSpatialObject}
\ifitkFullVersion
\input{LandmarkSpatialObject.tex}
\fi

\subsection{LineSpatialObject}
\label{sec:LineSpatialObject}
\ifitkFullVersion
\input{LineSpatialObject.tex}
\fi

\subsection{MeshSpatialObject}
\label{sec:MeshSpatialObject}
\ifitkFullVersion
\input{MeshSpatialObject.tex}
\fi

\subsection{SurfaceSpatialObject}
\label{sec:SurfaceSpatialObject}
\ifitkFullVersion
\input{SurfaceSpatialObject.tex}
\fi

\subsection{TubeSpatialObject}

\doxygen{TubeSpatialObject} represents a base class for the representation
of tubular structures using SpatialObjects. The classes \doxygen{VesselTubeSpatialObject} and
\doxygen{DTITubeSpatialObject} derive from this base class.
VesselTubeSpatialObject represents blood vessels extracted for an image and
DTITubeSpatialObject is used to represent fiber tracts from diffusion tensor images.

\label{sec:TubeSpatialObject}
\ifitkFullVersion
\input{TubeSpatialObject.tex}
\fi

\subsubsection{VesselTubeSpatialObject}
\label{sec:VesselTubeSpatialObject}
\ifitkFullVersion
\input{VesselTubeSpatialObject.tex}
\fi

\subsubsection{DTITubeSpatialObject}
\label{sec:DTITubeSpatialObject}
\ifitkFullVersion
\input{DTITubeSpatialObject.tex}
\fi

\section{SceneSpatialObject}
\label{sec:Scene}
\ifitkFullVersion
\input{SceneSpatialObject.tex}
\fi

\section{Read/Write SpatialObjects}
\label{sec:ReadWriteSpatialObjects}
\ifitkFullVersion
\input{ReadWriteSpatialObject.tex}
\fi

\section{Statistics Computation via SpatialObjects}
\label{sec:SpatialObjectToImageStatisticsCalculator}
\ifitkFullVersion
\input{SpatialObjectToImageStatisticsCalculator.tex}
\fi
